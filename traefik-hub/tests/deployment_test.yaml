suite: deployment tests
release:
  name: traefik-hub
  namespace: traefik
tests:
  - it: should render a deployment
    set:
    template: deployment.yaml
    asserts:
      - isKind:
          of: Deployment
  - it: should set the image
    set:
      image: test
    template: deployment.yaml
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: test
  - it: should set the serviceAccountName
    set:
      serviceAccountName: test
    template: deployment.yaml
    asserts:
      - equal:
          path: spec.template.spec.serviceAccountName
          value: test
  - it: should set the namespace
    release:
      namespace: test
    set:
    template: deployment.yaml
    asserts:
      - equal:
          path: metadata.namespace
          value: test
  - it: should set resources
    release:
      namespace: test
    set:
      resources:
        requests:
          memory: 128Mi
          cpu: 100m
        limits:
          memory: 256Mi
          cpu: 200m
    template: deployment.yaml
    asserts:
      - equal:
          path: spec.template.spec.containers[0].resources
          value:
            requests:
              memory: 128Mi
              cpu: 100m
            limits:
              memory: 256Mi
              cpu: 200m
  - it: should add arguments
    release:
      namespace: test
    set:
      additionalArguments:
        - --test
    template: deployment.yaml
    asserts:
      - contains:
          path: spec.template.spec.containers[0].args
          content: --test
  - it: should add env variables
    release:
      namespace: test
    set:
      additionalEnvVars:
        - name: TEST
          value: "test"
    template: deployment.yaml
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: TEST
            value: "test"
