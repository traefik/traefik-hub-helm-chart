suite: config-map tests
templates:
  - config-map.yaml
release:
  name: traefik-hub
  namespace: traefik
tests:
  - it: should fail retrieving the secret
    asserts:
      - failedTemplate:
          errorMessage: "failed to lookup token from secret traefik/hub-agent-token"
  - it: should set the token
    set:
      unitTest: true
    asserts:
      - matchRegex:
          path: data["static.yaml"]
          pattern: ".*token: xxx.*"
  - it: should render the config-map
    set:
      unitTest: true
    asserts:
      - isKind:
          of: ConfigMap
      - equal:
          path: metadata.name
          value: traefik-static-config
      - equal:
          path: metadata.namespace
          value: traefik
  - it: should lookup the good secret
    set:
      hubTokenSecretName: test
    asserts:
      - failedTemplate:
          errorMessage: "failed to lookup token from secret traefik/test"
